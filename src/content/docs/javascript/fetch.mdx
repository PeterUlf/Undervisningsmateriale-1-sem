---
title: Fetch API
description: Hent data fra en API med JavaScript Fetch
sidebar:
  label: Fetch API
  order: 4
  badge:
    text: Tema 8
    variant: tip
    class: badge-theme-8
---

import Slide from "../../../components/Slide.astro";

<Slide>

## Hvad er Fetch?

**Fetch** er en moderne JavaScript metode til at hente data fra en server/API.

### Typisk workflow:

1. **Fetch** data fra en URL (API endpoint)
2. **Parse** JSON response til JavaScript object
3. **Brug** dataen i din app (vis produkter, osv.)

```javascript
fetch("https://api.example.com/products")
  .then((response) => response.json())
  .then((data) => {
    console.log(data);
  });
```

</Slide>
<div class="page-break"></div>
<Slide>

## Simpelt Fetch eksempel

```javascript
// Hent data fra en API
fetch("https://jsonplaceholder.typicode.com/users")
  .then((response) => response.json()) // Parser JSON
  .then((users) => {
    console.log(users); // Array af user objekter
    users.forEach((user) => {
      console.log(user.name);
    });
  })
  .catch((error) => {
    console.error("Fejl:", error);
  });
```

### Trin for trin:

1. `fetch(url)` - starter request til URL'en
2. `.then(response => response.json())` - konverterer response til JavaScript
3. `.then(data => {...})` - bruger dataen
4. `.catch(error => {...})` - håndterer fejl

</Slide>
<div class="page-break"></div>
<Slide>

## Fetch med async/await (moderne måde)

**Async/await** gør koden lettere at læse:

<div class="columns-2">

<div>

### Med .then()

```javascript
fetch("url")
  .then((response) => response.json())
  .then((data) => {
    console.log(data);
  })
  .catch((error) => {
    console.error(error);
  });
```

</div>

<div>

### Med async/await

```javascript
async function getData() {
  try {
    const response = await fetch("url");
    const data = await response.json();
    console.log(data);
  } catch (error) {
    console.error(error);
  }
}

getData();
```

</div>

</div>

**Fordele ved async/await:**

- Lettere at læse (ser ud som normal kode)
- Bedre fejlhåndtering med try/catch
- Nemmere at arbejde med flere requests

</Slide>
<div class="page-break"></div>
<Slide>

## Praktisk eksempel: Hent produkter

```javascript
async function fetchProducts() {
  try {
    // 1. Fetch data
    const response = await fetch("https://api.example.com/products");

    // 2. Check om request lykkedes
    if (!response.ok) {
      throw new Error("Kunne ikke hente produkter");
    }

    // 3. Parse JSON
    const products = await response.json();

    // 4. Brug dataen
    displayProducts(products);
  } catch (error) {
    console.error("Fejl:", error);
    document.querySelector("#error").textContent =
      "Kunne ikke indlæse produkter";
  }
}

function displayProducts(products) {
  products.forEach((product) => {
    console.log(`${product.name}: ${product.price} kr`);
  });
}

// Kald funktionen
fetchProducts();
```

</Slide>
<div class="page-break"></div>
<Slide>

## Vis produkter på siden

```javascript
async function loadProducts() {
  const response = await fetch("https://api.example.com/products");
  const products = await response.json();

  const container = document.querySelector("#product-list");

  products.forEach((product) => {
    // Opret HTML for hvert produkt
    const html = `
      <article class="product">
        <img src="${product.image}" alt="${product.name}">
        <h2>${product.name}</h2>
        <p>${product.description}</p>
        <p class="price">${product.price} kr</p>
      </article>
    `;

    container.insertAdjacentHTML("beforeend", html);
  });
}

loadProducts();
```

```html
<div id="product-list"></div>
```

</Slide>
<div class="page-break"></div>
<Slide>

## Query Parameters i URL

Du kan tilføje parametre til URL'en for at filtrere eller sortere data:

```javascript
// Grundlæggende URL
const baseUrl = "https://api.example.com/products";

// Tilføj query parameters
const url = `${baseUrl}?category=electronics&limit=10`;

// Eller brug URLSearchParams
const params = new URLSearchParams({
  category: "electronics",
  limit: 10,
  sort: "price",
});

const fullUrl = `${baseUrl}?${params}`;
// https://api.example.com/products?category=electronics&limit=10&sort=price

const response = await fetch(fullUrl);
const data = await response.json();
```

### Almindelige query parameters:

- `?limit=10` - begræns antal resultater
- `?category=electronics` - filtrer efter kategori
- `?sort=price` - sorter efter pris
- `?id=5` - hent specifik item

</Slide>
<div class="page-break"></div>
<Slide>

## Hent enkelt produkt (single view)

```javascript
// URL med produkt ID
const productId = 5;
const url = `https://api.example.com/products/${productId}`;

async function loadProduct() {
  try {
    const response = await fetch(url);
    const product = await response.json();

    // Vis produkt detaljer
    document.querySelector("#product-name").textContent = product.name;
    document.querySelector("#product-price").textContent =
      product.price + " kr";
    document.querySelector("#product-image").src = product.image;
    document.querySelector("#product-description").textContent =
      product.description;
  } catch (error) {
    console.error("Fejl:", error);
  }
}

loadProduct();
```

```html
<h1 id="product-name"></h1>
<img id="product-image" alt="" />
<p id="product-description"></p>
<p id="product-price"></p>
```

</Slide>
<div class="page-break"></div>
<Slide>

## Hent ID fra URL (URLSearchParams)

Når du klikker på et produkt og går til `productdetails.html?id=5`, kan du hente ID'et:

```javascript
// URL: productdetails.html?id=5

// Hent query parameters fra URL
const params = new URLSearchParams(window.location.search);
const productId = params.get("id");

console.log(productId); // "5"

// Brug ID til at fetche produktet
async function loadProduct() {
  const response = await fetch(`https://api.example.com/products/${productId}`);
  const product = await response.json();

  // Vis produkt...
  document.querySelector("h1").textContent = product.name;
}

loadProduct();
```

### Link til product details:

```html
<a href="productdetails.html?id=5">Se produkt</a>
```

</Slide>
<div class="page-break"></div>
<Slide>

## Loading state

Vis en loading-besked mens data hentes:

```javascript
async function loadProducts() {
  const container = document.querySelector("#product-list");

  // Vis loading
  container.innerHTML = "<p>Henter produkter...</p>";

  try {
    const response = await fetch("https://api.example.com/products");
    const products = await response.json();

    // Ryd loading besked
    container.innerHTML = "";

    // Vis produkter
    products.forEach((product) => {
      const html = `
        <article>
          <h2>${product.name}</h2>
          <p>${product.price} kr</p>
        </article>
      `;
      container.insertAdjacentHTML("beforeend", html);
    });
  } catch (error) {
    container.innerHTML = "<p>Kunne ikke hente produkter</p>";
  }
}
```

</Slide>
<div class="page-break"></div>
<Slide>

## Fejlhåndtering

Altid håndter fejl når du bruger fetch:

```javascript
async function fetchData() {
  try {
    const response = await fetch("https://api.example.com/data");

    // Check HTTP status
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }

    const data = await response.json();
    return data;
  } catch (error) {
    // Håndter forskellige fejl
    if (error.message.includes("Failed to fetch")) {
      console.error("Ingen internetforbindelse");
    } else {
      console.error("Fejl:", error.message);
    }

    // Vis fejl til brugeren
    document.querySelector("#error").textContent =
      "Kunne ikke hente data. Prøv igen senere.";
  }
}
```

</Slide>
<div class="page-break"></div>
<Slide>

## Komplet eksempel: Produktliste + Details

**products.html** - vis alle produkter:

```javascript
async function loadProducts() {
  const response = await fetch("https://api.example.com/products");
  const products = await response.json();

  const list = document.querySelector("#product-list");

  products.forEach((product) => {
    list.insertAdjacentHTML(
      "beforeend",
      `
      <article>
        <h2>${product.name}</h2>
        <p>${product.price} kr</p>
        <a href="productdetails.html?id=${product.id}">Se mere</a>
      </article>
    `,
    );
  });
}

loadProducts();
```

</Slide>
<div class="page-break"></div>
<Slide>

**productdetails.html** - vis ét produkt:

```javascript
// Hent ID fra URL
const params = new URLSearchParams(window.location.search);
const id = params.get("id");

async function loadProduct() {
  const response = await fetch(`https://api.example.com/products/${id}`);
  const product = await response.json();

  document.querySelector("h1").textContent = product.name;
  document.querySelector("#price").textContent = product.price + " kr";
  document.querySelector("#description").textContent = product.description;
  document.querySelector("#image").src = product.image;
}

loadProduct();
```

```html
<h1></h1>
<img id="image" alt="" />
<p id="description"></p>
<p id="price"></p>
<a href="products.html">← Tilbage til produkter</a>
```

</Slide>
<div class="page-break"></div>
<Slide>

## Opgaver

### Opgave 1: Hent data fra API

Hent data fra denne API: `https://jsonplaceholder.typicode.com/users`

1. Brug fetch til at hente alle users
2. Log dem i konsollen
3. Vis kun navnene på siden i en liste

### Opgave 2: Fejlhåndtering

Prøv at fetche fra en URL der ikke eksisterer. Håndter fejlen og vis en brugervenlig besked.

### Opgave 3: Query parameters

Hent posts fra: `https://jsonplaceholder.typicode.com/posts`

1. Hent kun de første 5 posts (brug `?_limit=5`)
2. Vis deres titles på siden

### Opgave 4: Single view

1. Lav en products.html der viser alle posts fra API'en
2. Hver post skal linke til postdetails.html?id=X
3. På postdetails.html skal du vise den specifikke post baseret på ID'et i URL'en

</Slide>
<div class="page-break"></div>
<Slide>

## Næste skridt

Nu kan du hente data fra API'er! Næste trin:

[Single View opgave →](/javascript/single-view/)

[Objects & JSON →](/javascript/objects-json/)

[Arrow Functions →](/javascript/arrow-functions/)

</Slide>
